!function(a){function t(a,t,n){var i=a.find("canvas"),r=i[0];r.width=a.width()+10,r.height=a.height()+10;var o=r.getContext("2d");o.clearRect(0,0,r.width,r.height),o.beginPath();var l=a.width()/2;o.arc(r.width/2,r.height/2,l,e(t)-Math.PI/2,e(n)-Math.PI/2,!1),o.lineWidth=8,o.strokeStyle=i.css("color"),o.stroke()}function e(a){return a*(Math.PI/180)}function n(e){var n=e.find(".handle"),i=e.find(".handle1"),r=e.find(".handle2"),o=e.width();e.height(o);var l=o/2,d=n.width(),s=n.height();n.each(function(t,n){var i=a(n),r=i.attr("data-value"),o=Math.round(l*Math.sin(r*Math.PI/180)),c=Math.round(l*-Math.cos(r*Math.PI/180));i.css({left:o+l-d/2,top:c+l-s/2}),e.find(i.attr("data-value-target")).html(i.attr("data-value")+"&deg;")}),value1=i.attr("data-value"),value2=r.attr("data-value"),t(e,value1,value2),e.find("input").val(value1+";"+value2).trigger("change")}function i(t){var e=t.val()||"0;0";e=e.split(";");var i=parseInt(e[0],10),l=parseInt(e[1],10);$container=a('<div class="circle-range-select-wrapper"></div>'),t.wrap($container),$container=t.parent(),$container.append('<div class="handle handle1" data-value="'+i+'" data-value-target=".value1"></div>'),$container.append('<div class="handle handle2" data-value="'+l+'" data-value-target=".value2"></div>'),$container.append('<div class="values"><span class="value1"></span> - <span class="value2"></span></div>'),$container.append('<canvas class="selected-range"></canvas>'),n($container),$container.on("mousedown touchstart",".handle",function(t){r=!0,t.preventDefault(),o=a(t.target),a(document).one("mouseup touchend",function(){r=!1,o=null})}),a(window).on("resize",n.bind(null,$container))}var r=!1,o=null;a(document).on("mousemove touchmove",function(t){if(r){var e=o.closest(".circle-range-select-wrapper"),i=e.width()/2;if(!t.offsetX&&t.originalEvent.touches){var l=a(t.target).offset();t.offsetX=t.originalEvent.touches[0].pageX-l.left,t.offsetY=t.originalEvent.touches[0].pageY-l.top}else if("undefined"==typeof t.offsetX||"undefined"==typeof t.offsetY){var l=a(t.target).offset();t.offsetX=t.pageX-l.left,t.offsetY=t.pageY-l.top}var d={x:t.target.offsetLeft+t.offsetX,y:t.target.offsetTop+t.offsetY},s=Math.atan2(d.x-i,d.y-i),c=-s/(Math.PI/180)+180,u=Math.abs(c-90*Math.round(c/90));5>=u&&(c=90*Math.round(c/90)),360==c&&(c=0);var h=Math.round(c);o.attr("data-value",h),n(e)}}),a.fn.lcnCircleRangeSelect=function(){return this.each(function(){i(a(this))})}}(jQuery);